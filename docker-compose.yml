version: "3"

services:
  httpserv:
    build:
      dockerfile: Dockerfile
      context: ./httpserv
    ports:
      - "8080:8080"
    volumes:
      - shared-volume:/filefolder

  rapid-runner-rabbit:
      container_name: "rapid-runner-rabbit"
      image: rabbitmq:3.11.2-alpine
      networks:
        - rabbit

  obse:
    restart: on-failure
    depends_on:
      - rapid-runner-rabbit
    links: 
      - rapid-runner-rabbit
    build:
      dockerfile: Dockerfile
      context: ./obse
    volumes:
      - shared-volume:/filefolder
    networks:
      - rabbit

  imed:
    restart: on-failure
    depends_on:
      - rapid-runner-rabbit
      - obse
    links: 
      - rapid-runner-rabbit
    build:
      dockerfile: Dockerfile
      context: ./imed
    networks:
      - rabbit
  
  orig:
    restart: on-failure
    depends_on:
      - rapid-runner-rabbit
      - obse
      - imed
    links: 
      - rapid-runner-rabbit
    build:
      dockerfile: Dockerfile
      context: ./orig
    networks:
      - rabbit

networks:
 rabbit:
  driver: bridge

volumes:
  shared-volume: